<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #000;
            font-family: 'Courier New', monospace;
            color: #fff;
            overflow: hidden;
        }

        #game-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 32px;
            text-align: center;
            line-height: 1.8;
            white-space: pre-wrap;
            opacity: 0;
            transition: opacity 0.5s;
        }

        #game-text.show {
            opacity: 1;
            animation: textGlitch 0.3s infinite;
        }

        @keyframes textGlitch {
            0% { text-shadow: -2px -2px 0 #ff0000, 2px 2px 0 #00ffff; }
            25% { text-shadow: 2px -2px 0 #ff0000, -2px 2px 0 #00ffff; }
            50% { text-shadow: -3px 2px 0 #ff0000, 3px -2px 0 #00ffff; }
            75% { text-shadow: 2px 3px 0 #ff0000, -2px -3px 0 #00ffff; }
            100% { text-shadow: -2px -2px 0 #ff0000, 2px 2px 0 #00ffff; }
        }

        @keyframes glitchScreen {
            0% { 
                background: #000;
                transform: translate(0, 0);
            }
            5% { 
                background: #fff;
                transform: translate(-10px, 5px);
            }
            10% { 
                background: #f00;
                transform: translate(5px, -8px);
            }
            15% { 
                background: #000;
                transform: translate(-8px, -5px);
            }
            20% { 
                background: #0ff;
                transform: translate(10px, 8px);
            }
            25% { 
                background: #000;
                transform: translate(-5px, 10px);
            }
            30% { 
                background: #ff0;
                transform: translate(8px, -10px);
            }
            35% { 
                background: #000;
                transform: translate(-10px, 5px);
            }
            40% { 
                background: #fff;
                transform: translate(5px, -5px);
            }
            45% { 
                background: #f0f;
                transform: translate(-8px, 8px);
            }
            50% { 
                background: #000;
                transform: translate(10px, -8px);
            }
            55% { 
                background: #0f0;
                transform: translate(-10px, -10px);
            }
            60% { 
                background: #fff;
                transform: translate(8px, 5px);
            }
            65% { 
                background: #00f;
                transform: translate(-5px, -8px);
            }
            70% { 
                background: #000;
                transform: translate(10px, 10px);
            }
            75% { 
                background: #f00;
                transform: translate(-8px, 5px);
            }
            80% { 
                background: #fff;
                transform: translate(5px, -10px);
            }
            85% { 
                background: #0ff;
                transform: translate(-10px, 8px);
            }
            90% { 
                background: #000;
                transform: translate(8px, -5px);
            }
            95% { 
                background: #ff0;
                transform: translate(-5px, -8px);
            }
            100% { 
                background: #fff;
                transform: translate(0, 0);
            }
        }

        #questions {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            max-width: 600px;
            opacity: 0;
            transition: opacity 0.5s;
        }

        #questions.show {
            opacity: 1;
        }

        .question-container {
            text-align: center;
            margin-bottom: 40px;
        }

        .question-text {
            font-size: 28px;
            margin-bottom: 30px;
            line-height: 1.6;
            animation: textGlitch 0.3s infinite;
        }

        .buttons-container {
            display: flex;
            gap: 30px;
            justify-content: center;
        }

        .answer-btn {
            padding: 15px 50px;
            font-size: 20px;
            font-family: 'Courier New', monospace;
            background: #000;
            color: #fff;
            border: 2px solid #fff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .answer-btn:hover {
            background: #fff;
            color: #000;
        }

        .glitch-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: glitchScreen 0.5s infinite;
            z-index: 1000;
        }

        .glitch-screen-text {
            font-size: 80px;
            animation: textGlitch 0.05s infinite;
            position: relative;
        }

        .glitch-screen-text::before,
        .glitch-screen-text::after {
            content: 'ERROR';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .glitch-screen-text::before {
            animation: glitchTextLayer1 0.1s infinite;
            color: #ff0000;
            z-index: -1;
        }

        .glitch-screen-text::after {
            animation: glitchTextLayer2 0.15s infinite;
            color: #00ffff;
            z-index: -2;
        }

        @keyframes glitchTextLayer1 {
            0% { transform: translate(-5px, -5px); opacity: 0.8; }
            25% { transform: translate(10px, 5px); opacity: 0.7; }
            50% { transform: translate(-8px, 10px); opacity: 0.9; }
            75% { transform: translate(12px, -8px); opacity: 0.6; }
            100% { transform: translate(-5px, 8px); opacity: 0.8; }
        }

        @keyframes glitchTextLayer2 {
            0% { transform: translate(5px, 5px); opacity: 0.7; }
            33% { transform: translate(-10px, -5px); opacity: 0.8; }
            66% { transform: translate(8px, -10px); opacity: 0.6; }
            100% { transform: translate(5px, 8px); opacity: 0.7; }
        }

        #transition-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s;
        }

        #transition-container.show {
            opacity: 1;
        }

        .continue-btn {
            padding: 15px 50px;
            font-size: 20px;
            font-family: 'Courier New', monospace;
            background: #000;
            color: #fff;
            border: 2px solid #fff;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 40px;
            opacity: 0;
            transition: opacity 0.5s, background 0.3s, color 0.3s;
        }

        .continue-btn.show {
            opacity: 1;
        }

        .continue-btn:hover {
            background: #fff;
            color: #000;
        }

        .transition-text {
            font-size: 32px;
            line-height: 1.8;
            white-space: pre-wrap;
            animation: textGlitch 0.3s infinite;
            margin-bottom: 30px;
        }
    </style>
</head>
<body>
    <div id="game-text"></div>
    <div id="questions"></div>
    <div id="transition-container"></div>

    <script>
        // Audio
        let audioContext = null;

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            return audioContext;
        }

        function playTypeSound() {
            try {
                const ctx = initAudio();
                if (ctx.state === 'suspended') {
                    ctx.resume();
                }
                
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                const filter = ctx.createBiquadFilter();
                
                oscillator.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(ctx.destination);
                
                oscillator.frequency.value = 700 + Math.random() * 300;
                oscillator.type = 'square';
                
                filter.type = 'lowpass';
                filter.frequency.value = 2000;
                filter.Q.value = 1;
                
                const now = ctx.currentTime;
                gainNode.gain.setValueAtTime(0.2, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                
                oscillator.start(now);
                oscillator.stop(now + 0.1);
            } catch (e) {
                console.log('Audio:', e.message);
            }
        }

        // Texte d'introduction
        const gameText = document.getElementById('game-text');
        const questionsDiv = document.getElementById('questions');
        const transitionContainer = document.getElementById('transition-container');
        const introText = `It was pretty obvious, wasn't it?\nYou won't get away that easily.\nLet's play a game.\nTrue or false?`;

        async function showIntro() {
            await new Promise(resolve => setTimeout(resolve, 500));
            initAudio();
            gameText.classList.add('show');
            
            for (let i = 0; i < introText.length; i++) {
                gameText.textContent = introText.substring(0, i + 1);
                if (introText[i] !== ' ' && introText[i] !== '\n') {
                    playTypeSound();
                }
                const delay = introText[i] === '\n' ? 400 : 
                             introText[i] === '.' ? 300 :
                             introText[i] === ',' ? 200 :
                             50 + Math.random() * 50;
                await new Promise(resolve => setTimeout(resolve, delay));
            }
            
            await new Promise(resolve => setTimeout(resolve, 2000));
            gameText.style.opacity = '0';
            await new Promise(resolve => setTimeout(resolve, 500));
            
            showQuestions();
        }

        // Questions
        const questions = [
            { text: 'You are now 17 years old.', answer: true },
            { text: 'Your favorite movie is 500 days of summer.', answer: true },
            { text: 'We started talking on June 6.', answer: false }
        ];

        let currentQuestion = 0;
        let answers = [];

        function showQuestions() {
            displayQuestion(0);
            questionsDiv.classList.add('show');
        }

        function displayQuestion(index) {
            questionsDiv.innerHTML = `
                <div class="question-container">
                    <div class="question-text">${questions[index].text}</div>
                    <div class="buttons-container">
                        <button class="answer-btn" onclick="handleAnswer(true)">true</button>
                        <button class="answer-btn" onclick="handleAnswer(false)">false</button>
                    </div>
                </div>
            `;
        }

        function handleAnswer(answer) {
            answers.push(answer);
            currentQuestion++;
            
            if (currentQuestion < questions.length) {
                displayQuestion(currentQuestion);
            } else {
                checkAnswers();
            }
        }

        function checkAnswers() {
            const correct = answers[0] === true && answers[1] === true && answers[2] === false;
            
            if (correct) {
                questionsDiv.style.opacity = '0';
                setTimeout(() => {
                    questionsDiv.innerHTML = '';
                    showTransitionScreen();
                }, 500);
            } else {
                showGlitchScreen();
            }
        }

        async function showTransitionScreen() {
            const transitionText = `well, okay, this one was too easy for you...\nlet's get harder.`;
            
            transitionContainer.innerHTML = `
                <div class="transition-text"></div>
                <button class="continue-btn" onclick="continueGame()">continue</button>
            `;
            
            transitionContainer.classList.add('show');
            const textDiv = transitionContainer.querySelector('.transition-text');
            const continueBtn = transitionContainer.querySelector('.continue-btn');
            
            for (let i = 0; i < transitionText.length; i++) {
                textDiv.textContent = transitionText.substring(0, i + 1);
                if (transitionText[i] !== ' ' && transitionText[i] !== '\n') {
                    playTypeSound();
                }
                const delay = transitionText[i] === '\n' ? 400 : 
                             transitionText[i] === '.' ? 300 :
                             transitionText[i] === ',' ? 200 :
                             50 + Math.random() * 50;
                await new Promise(resolve => setTimeout(resolve, delay));
            }
            
            await new Promise(resolve => setTimeout(resolve, 500));
            continueBtn.classList.add('show');
        }

        function continueGame() {
            // À développer : passer à la phase suivante
            console.log('Continue clicked');
        }

        function showGlitchScreen() {
            const glitchDiv = document.createElement('div');
            glitchDiv.className = 'glitch-screen';
            glitchDiv.innerHTML = '<div class="glitch-screen-text">ERROR</div>';
            document.body.appendChild(glitchDiv);
            
            playGlitchSound();
            
            setTimeout(() => {
                glitchDiv.remove();
                stopGlitchSound();
                currentQuestion = 0;
                answers = [];
                displayQuestion(0);
            }, 2000);
        }

        // Son de glitch
        let glitchSource = null;
        let glitchGain = null;

        function playGlitchSound() {
            if (glitchSource) return;
            
            try {
                const ctx = initAudio();
                if (ctx.state === 'suspended') {
                    ctx.resume();
                }
                
                const bufferSize = ctx.sampleRate * 2.5;
                const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
                const data = buffer.getChannelData(0);
                
                for (let i = 0; i < bufferSize; i++) {
                    data[i] = Math.random() * 2 - 1;
                }
                
                glitchSource = ctx.createBufferSource();
                glitchSource.buffer = buffer;
                glitchSource.loop = false;
                
                glitchGain = ctx.createGain();
                const filter = ctx.createBiquadFilter();
                
                filter.type = 'bandpass';
                filter.frequency.value = 2500 + Math.random() * 1000;
                filter.Q.value = 0.3;
                
                glitchSource.connect(filter);
                filter.connect(glitchGain);
                glitchGain.connect(ctx.destination);
                
                const now = ctx.currentTime;
                glitchGain.gain.setValueAtTime(0, now);
                glitchGain.gain.linearRampToValueAtTime(0.25, now + 0.05);
                glitchGain.gain.linearRampToValueAtTime(0.2, now + 1);
                glitchGain.gain.linearRampToValueAtTime(0, now + 2);
                
                glitchSource.start(now);
                
                glitchSource.onended = () => {
                    glitchSource = null;
                    glitchGain = null;
                };
            } catch (e) {
                console.log('Glitch audio:', e.message);
            }
        }

        function stopGlitchSound() {
            if (!glitchSource) return;
            
            try {
                if (glitchSource) {
                    glitchSource.stop();
                    glitchSource = null;
                    glitchGain = null;
                }
            } catch (e) {
                glitchSource = null;
                glitchGain = null;
            }
        }

        // Démarrer le jeu
        showIntro();
    </script>
</body>
</html>
